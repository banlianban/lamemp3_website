# âœ… Docker æŽ¥å…¥å®ŒæˆæŠ¥å‘Š

**é¡¹ç›®åç§°:** HDR Ultra Web  
**å®Œæˆæ—¶é—´:** 2025-11-20  
**çŠ¶æ€:** âœ… å®Œæˆ

---

## ðŸ“¦ åˆ›å»ºçš„æ–‡ä»¶æ¸…å•

### æ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼ˆ6ä¸ªï¼‰

- âœ… `Dockerfile` - ç”Ÿäº§çŽ¯å¢ƒæž„å»ºé…ç½®
- âœ… `Dockerfile.dev` - å¼€å‘çŽ¯å¢ƒé…ç½®
- âœ… `.dockerignore` - æž„å»ºå¿½ç•¥æ–‡ä»¶
- âœ… `docker-compose.yml` - ç”Ÿäº§çŽ¯å¢ƒç¼–æŽ’ï¼ˆç®€å•ï¼‰
- âœ… `docker-compose.dev.yml` - å¼€å‘çŽ¯å¢ƒç¼–æŽ’
- âœ… `docker-compose.prod.yml` - ç”Ÿäº§çŽ¯å¢ƒç¼–æŽ’ï¼ˆå¸¦ Nginxï¼‰

### Nginx é…ç½®ï¼ˆ3ä¸ªï¼‰

- âœ… `nginx/nginx.conf` - Nginx ä¸»é…ç½®
- âœ… `nginx/conf.d/default.conf` - ç«™ç‚¹é…ç½®
- âœ… `nginx/logs/.gitkeep` - æ—¥å¿—ç›®å½•å ä½

### è¾…åŠ©å·¥å…·ï¼ˆ3ä¸ªï¼‰

- âœ… `Makefile` - å¿«æ·å‘½ä»¤
- âœ… `scripts/docker-check.sh` - çŽ¯å¢ƒæ£€æŸ¥è„šæœ¬
- âœ… `scripts/docker-deploy.sh` - å¿«é€Ÿéƒ¨ç½²è„šæœ¬

### CI/CD é…ç½®ï¼ˆ1ä¸ªï¼‰

- âœ… `.github/workflows/docker-build.yml` - GitHub Actions è‡ªåŠ¨æž„å»º

### æ–‡æ¡£ï¼ˆ6ä¸ªï¼‰

- âœ… `DOCKER-QUICK-START.md` - 5åˆ†é’Ÿå¿«é€Ÿå¼€å§‹
- âœ… `DOCKER-SETUP-SUMMARY.md` - å®Œæ•´æ€»ç»“
- âœ… `docs/development/DOCKER.md` - è¯¦ç»†éƒ¨ç½²æŒ‡å—
- âœ… `docs/development/DOCKER-CHECKLIST.md` - éƒ¨ç½²æ£€æŸ¥æ¸…å•
- âœ… `docs/development/DOCKER-QUICK-REFERENCE.md` - å‘½ä»¤é€ŸæŸ¥è¡¨
- âœ… `docs/development/DOCKER-FILES.md` - æ–‡ä»¶è¯´æ˜Ž

### æ›´æ–°çš„æ–‡ä»¶ï¼ˆ3ä¸ªï¼‰

- âœ… `README.md` - æ·»åŠ  Docker éƒ¨ç½²è¯´æ˜Ž
- âœ… `next.config.mjs` - å¯ç”¨ standalone è¾“å‡º
- âœ… `.gitignore` - å¿½ç•¥ Docker ç›¸å…³æ–‡ä»¶

**æ€»è®¡ï¼š22 ä¸ªæ–‡ä»¶**

---

## ðŸŽ¯ å®žçŽ°çš„åŠŸèƒ½

### å¼€å‘çŽ¯å¢ƒ

âœ… **çƒ­é‡è½½æ”¯æŒ**
- ä»£ç ä¿®æ”¹è‡ªåŠ¨åæ˜ 
- æºä»£ç æŒ‚è½½
- å®Œæ•´çš„å¼€å‘å·¥å…·é“¾

âœ… **å¿«é€Ÿå¯åŠ¨**
```bash
make dev
# æˆ–
./scripts/docker-deploy.sh dev
```

### ç”Ÿäº§çŽ¯å¢ƒï¼ˆç®€å•æ¨¡å¼ï¼‰

âœ… **ä¼˜åŒ–æž„å»º**
- å¤šé˜¶æ®µæž„å»º
- Alpine Linux åŸºç¡€é•œåƒ
- Standalone è¾“å‡ºæ¨¡å¼
- éž root ç”¨æˆ·è¿è¡Œ

âœ… **ç®€å•éƒ¨ç½²**
```bash
make up
# æˆ–
docker-compose up -d
```

### ç”Ÿäº§çŽ¯å¢ƒï¼ˆNginx æ¨¡å¼ï¼‰

âœ… **åå‘ä»£ç†**
- Nginx ä»£ç† Next.js
- é™æ€æ–‡ä»¶ç¼“å­˜
- Gzip åŽ‹ç¼©
- å®‰å…¨å¤´éƒ¨é…ç½®

âœ… **HTTPS æ”¯æŒ**
- SSL/TLS é…ç½®æ¨¡æ¿
- HTTP åˆ° HTTPS é‡å®šå‘

âœ… **æ€§èƒ½ä¼˜åŒ–**
- é™æ€èµ„æºç¼“å­˜ï¼ˆ1å¹´ï¼‰
- Gzip åŽ‹ç¼©
- HTTP/2 æ”¯æŒ

âœ… **å®Œæ•´éƒ¨ç½²**
```bash
make prod-up
# æˆ–
./scripts/docker-deploy.sh prod-nginx
```

### CI/CD

âœ… **è‡ªåŠ¨æž„å»º**
- GitHub Actions é›†æˆ
- æŽ¨é€è‡ªåŠ¨æž„å»º
- Tag è‡ªåŠ¨å‘å¸ƒ
- å¤šæž¶æž„æ”¯æŒï¼ˆamd64/arm64ï¼‰

### æ–‡æ¡£ç³»ç»Ÿ

âœ… **å®Œæ•´æ–‡æ¡£**
- å¿«é€Ÿå¼€å§‹æŒ‡å—
- è¯¦ç»†éƒ¨ç½²æŒ‡å—
- å‘½ä»¤é€ŸæŸ¥è¡¨
- æ£€æŸ¥æ¸…å•
- æ–‡ä»¶è¯´æ˜Ž

---

## ðŸš€ ä½¿ç”¨æ–¹æ³•

### ç¬¬ä¸€æ¬¡ä½¿ç”¨

```bash
# 1. æ£€æŸ¥çŽ¯å¢ƒ
./scripts/docker-check.sh

# 2. æŸ¥çœ‹å¸®åŠ©
make help

# 3. é€‰æ‹©æ¨¡å¼å¯åŠ¨
make dev          # å¼€å‘çŽ¯å¢ƒ
make up           # ç”Ÿäº§çŽ¯å¢ƒï¼ˆç®€å•ï¼‰
make prod-up      # ç”Ÿäº§çŽ¯å¢ƒï¼ˆNginxï¼‰
```

### å¸¸ç”¨å‘½ä»¤

```bash
make help         # æŸ¥çœ‹æ‰€æœ‰å‘½ä»¤
make dev          # å¯åŠ¨å¼€å‘çŽ¯å¢ƒ
make up           # å¯åŠ¨ç”Ÿäº§çŽ¯å¢ƒ
make logs         # æŸ¥çœ‹æ—¥å¿—
make down         # åœæ­¢æœåŠ¡
make clean        # æ¸…ç†èµ„æº
```

### è®¿é—®åœ°å€

| çŽ¯å¢ƒ | åœ°å€ | ç«¯å£ |
|-----|------|------|
| å¼€å‘çŽ¯å¢ƒ | http://localhost:3000 | 3000 |
| ç”Ÿäº§ï¼ˆç®€å•ï¼‰ | http://localhost:3000 | 3000 |
| ç”Ÿäº§ï¼ˆNginxï¼‰ | http://localhost | 80 |

---

## ðŸ“Š éƒ¨ç½²æ¨¡å¼å¯¹æ¯”

| ç‰¹æ€§ | å¼€å‘çŽ¯å¢ƒ | ç”Ÿäº§ï¼ˆç®€å•ï¼‰ | ç”Ÿäº§ï¼ˆNginxï¼‰ |
|-----|---------|-------------|--------------|
| **é…ç½®æ–‡ä»¶** | docker-compose.dev.yml | docker-compose.yml | docker-compose.prod.yml |
| **çƒ­é‡è½½** | âœ… | âŒ | âŒ |
| **é•œåƒä¼˜åŒ–** | âŒ | âœ… | âœ… |
| **åå‘ä»£ç†** | âŒ | âŒ | âœ… Nginx |
| **é™æ€ç¼“å­˜** | âŒ | âŒ | âœ… |
| **Gzip åŽ‹ç¼©** | âŒ | âŒ | âœ… |
| **HTTPS** | âŒ | âŒ | âœ… å¯é…ç½® |
| **å®¹å™¨æ•°é‡** | 1 | 1 | 2 |
| **å¯åŠ¨å‘½ä»¤** | `make dev` | `make up` | `make prod-up` |
| **é€‚ç”¨åœºæ™¯** | æœ¬åœ°å¼€å‘ | å¿«é€Ÿæµ‹è¯• | ç”Ÿäº§éƒ¨ç½² |

---

## ðŸ—ï¸ æŠ€æœ¯æž¶æž„

### å¤šé˜¶æ®µæž„å»º

```
Stage 1: deps (ä¾èµ–å®‰è£…)
    â†“
Stage 2: builder (åº”ç”¨æž„å»º)
    â†“
Stage 3: runner (æœ€ç»ˆé•œåƒ)
```

**ä¼˜åŠ¿:**
- é•œåƒä½“ç§¯å°ï¼ˆ~400MBï¼‰
- æž„å»ºé€Ÿåº¦å¿«ï¼ˆå±‚ç¼“å­˜ï¼‰
- å®‰å…¨æ€§é«˜ï¼ˆæœ€å°åŒ–æ”»å‡»é¢ï¼‰

### ç½‘ç»œæž¶æž„ï¼ˆç”Ÿäº§ + Nginxï¼‰

```
Internet
    â†“
[Nginx:80/443]
    â†“ (å†…éƒ¨ç½‘ç»œ)
[Next.js:3000]
```

---

## ðŸ”’ å®‰å…¨ç‰¹æ€§

âœ… **å®¹å™¨å®‰å…¨**
- éž root ç”¨æˆ·è¿è¡Œï¼ˆnextjs:1001ï¼‰
- æœ€å°åŒ–åŸºç¡€é•œåƒï¼ˆAlpineï¼‰
- åªåŒ…å«å¿…è¦æ–‡ä»¶

âœ… **ç½‘ç»œå®‰å…¨**
- å†…éƒ¨ç½‘ç»œéš”ç¦»
- Nginx åå‘ä»£ç†
- å®‰å…¨ HTTP å¤´éƒ¨

âœ… **æ•°æ®å®‰å…¨**
- æ— æ•°æ®æŒä¹…åŒ–ï¼ˆæ— çŠ¶æ€åº”ç”¨ï¼‰
- çŽ¯å¢ƒå˜é‡ä¸æš´éœ²
- æ—¥å¿—æ–‡ä»¶æƒé™æŽ§åˆ¶

---

## ðŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### æž„å»ºä¼˜åŒ–

- âœ… Docker layer ç¼“å­˜
- âœ… Next.js standalone æ¨¡å¼
- âœ… npm ci ä»£æ›¿ npm install
- âœ… å¤šé˜¶æ®µæž„å»º

### è¿è¡Œä¼˜åŒ–

- âœ… é™æ€æ–‡ä»¶ç¼“å­˜ï¼ˆ1å¹´ï¼‰
- âœ… Gzip åŽ‹ç¼©ï¼ˆæ–‡æœ¬ã€JSã€CSSï¼‰
- âœ… HTTP/2 æ”¯æŒ
- âœ… Keep-Alive è¿žæŽ¥
- âœ… èµ„æºé™åˆ¶ï¼ˆé˜²æ­¢ OOMï¼‰

### é¢„æœŸæ€§èƒ½

| æŒ‡æ ‡ | å€¼ |
|-----|-----|
| é•œåƒå¤§å° | ~400MB |
| å†…å­˜ä½¿ç”¨ | ~256-512MB |
| å¯åŠ¨æ—¶é—´ | ~5-10s |
| é¦–æ¬¡æž„å»º | ~2-5min |
| å¢žé‡æž„å»º | ~30-60s |

---

## ðŸ“š æ–‡æ¡£å¯¼èˆª

### å¿«é€Ÿå…¥é—¨

- ðŸš€ [5åˆ†é’Ÿå¿«é€Ÿå¼€å§‹](./DOCKER-QUICK-START.md) â­
- ðŸ“Š [å®Œæ•´æ€»ç»“](./DOCKER-SETUP-SUMMARY.md)

### è¯¦ç»†æŒ‡å—

- ðŸ“˜ [Docker éƒ¨ç½²æŒ‡å—](./docs/development/DOCKER.md)
- ðŸ“‹ [éƒ¨ç½²æ£€æŸ¥æ¸…å•](./docs/development/DOCKER-CHECKLIST.md)
- âš¡ [å‘½ä»¤é€ŸæŸ¥è¡¨](./docs/development/DOCKER-QUICK-REFERENCE.md)
- ðŸ“ [æ–‡ä»¶è¯´æ˜Ž](./docs/development/DOCKER-FILES.md)

### é¡¹ç›®æ–‡æ¡£

- ðŸ“– [é¡¹ç›® README](./README.md)
- ðŸƒ [å¿«é€Ÿå¯åŠ¨æŒ‡å—](./docs/development/QUICK-START.md)
- ðŸ§© [WASM é›†æˆ](./docs/development/WASM-INTEGRATION.md)

---

## âœ… éªŒè¯æ¸…å•

### çŽ¯å¢ƒæ£€æŸ¥

- âœ… Docker å·²å®‰è£…ï¼ˆ>= 20.10ï¼‰
- âœ… Docker Compose å·²å®‰è£…ï¼ˆ>= 2.0ï¼‰
- âœ… æ‰€æœ‰é…ç½®æ–‡ä»¶å·²åˆ›å»º
- âœ… è„šæœ¬å·²æ·»åŠ æ‰§è¡Œæƒé™
- âœ… ç«¯å£æœªè¢«å ç”¨

### åŠŸèƒ½æµ‹è¯•

```bash
# 1. è¿è¡ŒçŽ¯å¢ƒæ£€æŸ¥
./scripts/docker-check.sh

# 2. å¯åŠ¨å¼€å‘çŽ¯å¢ƒ
make dev

# 3. è®¿é—®åº”ç”¨
open http://localhost:3000

# 4. éªŒè¯åŠŸèƒ½
# - é¦–é¡µæ­£å¸¸æ˜¾ç¤º âœ…
# - è¯­è¨€åˆ‡æ¢æ­£å¸¸ âœ…
# - WASM åŠŸèƒ½æ­£å¸¸ âœ…
# - çƒ­é‡è½½å·¥ä½œæ­£å¸¸ âœ…

# 5. åœæ­¢æœåŠ¡
make dev-down
```

---

## ðŸŽ“ æœ€ä½³å®žè·µ

### å¼€å‘æµç¨‹

1. ä½¿ç”¨ `make dev` å¯åŠ¨å¼€å‘çŽ¯å¢ƒ
2. ä»£ç ä¿®æ”¹è‡ªåŠ¨çƒ­é‡è½½
3. å®ŒæˆåŽ `make dev-down` åœæ­¢

### ç”Ÿäº§éƒ¨ç½²

1. æ£€æŸ¥çŽ¯å¢ƒï¼š`./scripts/docker-check.sh`
2. æž„å»ºé•œåƒï¼š`make prod-build`
3. å¯åŠ¨æœåŠ¡ï¼š`make prod-up`
4. éªŒè¯éƒ¨ç½²ï¼šè®¿é—®å¹¶æµ‹è¯•
5. æŸ¥çœ‹æ—¥å¿—ï¼š`make prod-logs`

### æ›´æ–°æµç¨‹

```bash
git pull origin main
make prod-down
make prod-build
make prod-up
```

---

## ðŸ› å¸¸è§é—®é¢˜

### Q: ç«¯å£è¢«å ç”¨ï¼Ÿ

**A:** ä¿®æ”¹ `docker-compose.yml` ä¸­çš„ç«¯å£æ˜ å°„

```yaml
ports:
  - "3001:3000"  # æ”¹ç”¨ 3001 ç«¯å£
```

### Q: æž„å»ºå¾ˆæ…¢ï¼Ÿ

**A:** ä½¿ç”¨ BuildKit åŠ é€Ÿ

```bash
DOCKER_BUILDKIT=1 make build
```

### Q: å¦‚ä½•æŸ¥çœ‹æ—¥å¿—ï¼Ÿ

**A:** ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤

```bash
make logs
# æˆ–
docker logs -f hdr-ultra-web
```

### Q: WASM æ–‡ä»¶æ— æ³•åŠ è½½ï¼Ÿ

**A:** æ£€æŸ¥ `.dockerignore` ç¡®ä¿ `public/wasm/` æ²¡æœ‰è¢«æŽ’é™¤

---

## ðŸ”„ ä¸‹ä¸€æ­¥å»ºè®®

### å¿…åšé¡¹

- [ ] æµ‹è¯•å¼€å‘çŽ¯å¢ƒï¼ˆ`make dev`ï¼‰
- [ ] æµ‹è¯•ç”Ÿäº§çŽ¯å¢ƒï¼ˆ`make up`ï¼‰
- [ ] é˜…è¯»å¿«é€Ÿå¼€å§‹æ–‡æ¡£

### æŽ¨èé¡¹ï¼ˆç”Ÿäº§çŽ¯å¢ƒï¼‰

- [ ] é…ç½®åŸŸåå’Œ DNS
- [ ] é…ç½® SSL è¯ä¹¦ï¼ˆHTTPSï¼‰
- [ ] è®¾ç½®é˜²ç«å¢™è§„åˆ™
- [ ] é…ç½®æ—¥å¿—è½®è½¬
- [ ] é›†æˆç›‘æŽ§ç³»ç»Ÿ
- [ ] é…ç½®è‡ªåŠ¨å¤‡ä»½

### å¯é€‰é¡¹

- [ ] é…ç½® CDN
- [ ] é›†æˆ Redis ç¼“å­˜
- [ ] æ·»åŠ é€ŸçŽ‡é™åˆ¶
- [ ] å¤šå‰¯æœ¬éƒ¨ç½²
- [ ] é…ç½® CI/CD è‡ªåŠ¨éƒ¨ç½²

---

## ðŸ’¡ æç¤º

### çŽ¯å¢ƒå˜é‡é…ç½®

ç”±äºŽ `.env*` æ–‡ä»¶è¢« `.gitignore` é˜»æ­¢ï¼Œéœ€è¦æ‰‹åŠ¨åˆ›å»ºï¼š

```bash
# å¼€å‘çŽ¯å¢ƒ
cat > .env.local << EOF
NEXT_TELEMETRY_DISABLED=1
NODE_ENV=development
EOF

# ç”Ÿäº§çŽ¯å¢ƒ
cat > .env.production << EOF
NEXT_TELEMETRY_DISABLED=1
NODE_ENV=production
NEXT_PUBLIC_SITE_URL=https://yourdomain.com
EOF
```

### æŸ¥çœ‹æ‰€æœ‰å‘½ä»¤

```bash
make help
```

### èŽ·å–å¸®åŠ©

```bash
./scripts/docker-check.sh      # çŽ¯å¢ƒæ£€æŸ¥
./scripts/docker-deploy.sh     # æŸ¥çœ‹éƒ¨ç½²é€‰é¡¹
```

---

## ðŸ“ž æ”¯æŒ

å¦‚é‡é—®é¢˜ï¼š

1. æŸ¥çœ‹ç›¸å…³æ–‡æ¡£
2. æ£€æŸ¥å®¹å™¨æ—¥å¿—
3. è¿è¡ŒçŽ¯å¢ƒæ£€æŸ¥è„šæœ¬
4. æäº¤ Issue

---

## ðŸŽ‰ å®Œæˆï¼

æ­å–œï¼Docker å·²æˆåŠŸæŽ¥å…¥ HDR Ultra Web é¡¹ç›®ã€‚

çŽ°åœ¨ä½ å¯ä»¥ï¼š

- âœ… ä½¿ç”¨ Docker è¿›è¡Œæœ¬åœ°å¼€å‘
- âœ… ä¸€é”®éƒ¨ç½²åˆ°ç”Ÿäº§çŽ¯å¢ƒ
- âœ… ä½¿ç”¨ Nginx è¿›è¡Œåå‘ä»£ç†
- âœ… é€šè¿‡ CI/CD è‡ªåŠ¨æž„å»º
- âœ… äº«å—å®Œæ•´çš„æ–‡æ¡£æ”¯æŒ

**å¼€å§‹ä½¿ç”¨ï¼š**

```bash
./scripts/docker-check.sh
make help
make dev
```

**ç¥ä½¿ç”¨æ„‰å¿«ï¼** ðŸš€

---

*ç”Ÿæˆæ—¶é—´: 2025-11-20*  
*æ–‡æ¡£ç‰ˆæœ¬: 1.0*

